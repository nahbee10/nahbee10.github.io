<!DOCTYPE html>
<html >
  <head>
    <meta charset="UTF-8">
    <title>Gelly circle</title>

        <link rel="stylesheet" href="style.css">
    
  </head>

  <body>

    <canvas id="c" style="position: absolute"></canvas>


	<div id="container">
	    <video autoplay="true" id="videoElement">
	     
	    </video>
	</div>
	<script>
		var video = document.querySelector("#videoElement");
		 
		navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia || navigator.msGetUserMedia || navigator.oGetUserMedia;
		 
		if (navigator.getUserMedia) {       
		    navigator.getUserMedia({video: true}, handleVideo, videoError);
		}
		 
		function handleVideo(stream) {
		    video.src = window.URL.createObjectURL(stream);
		}
		 
		function videoError(e) {
		    // do something
	}
	</script>

	<script>

			document.addEventListener('DOMContentLoaded', function(){
			    var v = document.getElementById('videoElement');
			    var canvas = document.getElementById('c');
			    var context = canvas.getContext('2d');
			    var back = document.createElement('canvas');
			    var backcontext = back.getContext('2d');

			    var cw,ch;
	    
		        cw = v.clientWidth;
		        ch = v.clientHeight;
		        canvas.width = cw;
		        canvas.height = ch;
		        back.width = cw;
		        back.height = ch;
		        draw(v,context,backcontext,cw,ch);
		        back.style.display = 'none';

			},false);

		    function draw(v,c,bc,w,h) {
			    // First, draw it into the backing canvas
			    bc.drawImage(v,0,0,w,h);
			    // Grab the pixel data from the backing canvas
			    var idata = bc.getImageData(0,0,w,h);
			    var data = idata.data;
			    // Loop through the pixels, turning them grayscale
			    for(var i = 0; i < data.length; i+=4) {
			        var r = data[i];
			        var g = data[i+1];
			        var b = data[i+2];
			        var brightness = (3*r+4*g+b)>>>3;
			        data[i] = brightness;
			        data[i+1] = brightness;
			        data[i+2] = brightness;
			    }
			    idata.data = data;
			    // Draw the pixels onto the visible canvas
			    c.putImageData(idata,0,0);
			    // Start over!
			    setTimeout(function(){ draw(v,c,bc,w,h); }, 0);
			}

		/*function draw(v,c,w,h) {

		    c.drawImage(v,0,0,w,h);
		    // Grab the pixel data from the backing canvas
		    var idata = c.getImageData(0,0,w,h);
		    var data = idata.data;
		    // Loop through the pixels, turning them grayscale
		    for(var i = 0; i < data.length; i+=4) {
		        var r = data[i];
		        var g = data[i+1];
		        var b = data[i+2];
		        var brightness = (3*r+4*g+b)>>>3;
		        //console.log(brightness);
		        data[i] = brightness;
		        data[i+1] = brightness;
		        data[i+2] = brightness;
		    }
		    idata.data = data;
		    // Draw the pixels onto the visible canvas
		    c.putImageData(idata,0,0);
		    // Start over!
		    setTimeout(function(){ draw(v,c,w,h); }, 0);
		}*/

	</script>
	    
	    
	    
  </body>
</html>